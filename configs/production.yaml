# Production SignalFence Configuration
# Production-ready settings with comprehensive rate limiting

defaults:
  capacity: 50           # Balanced default for most endpoints
  refill_rate: 2.0       # 120 req/min sustained
  enabled: true

policies:
  # Authentication endpoints - very strict
  "/api/v1/auth/login":
    capacity: 5
    refill_rate: 0.083   # ~5 req/min (prevent brute force)
    enabled: true

  "/api/v1/auth/register":
    capacity: 3
    refill_rate: 0.016   # ~1 req/min (prevent spam)
    enabled: true

  "/api/v1/auth/password/reset":
    capacity: 3
    refill_rate: 0.05    # ~3 req/min
    enabled: true

  # Public read endpoints - lenient
  "/api/v1/products/list":
    capacity: 200
    refill_rate: 20.0    # 1200 req/min
    enabled: true

  "/api/v1/products/search":
    capacity: 150
    refill_rate: 15.0    # 900 req/min
    enabled: true

  "/api/v1/categories":
    capacity: 100
    refill_rate: 10.0    # 600 req/min
    enabled: true

  # User data endpoints - moderate
  "/api/v1/users/profile":
    capacity: 50
    refill_rate: 5.0     # 300 req/min
    enabled: true

  "/api/v1/users/settings":
    capacity: 30
    refill_rate: 1.0     # 60 req/min
    enabled: true

  # Write operations - stricter
  "/api/v1/products/create":
    capacity: 10
    refill_rate: 0.166   # ~10 req/min
    enabled: true

  "/api/v1/products/update":
    capacity: 20
    refill_rate: 0.33    # ~20 req/min
    enabled: true

  "/api/v1/products/delete":
    capacity: 5
    refill_rate: 0.083   # ~5 req/min
    enabled: true

  # File upload - very strict
  "/api/v1/upload":
    capacity: 5
    refill_rate: 0.033   # ~2 req/min
    enabled: true

  # Admin endpoints - moderate (assuming separate API key auth)
  "/api/v1/admin/users":
    capacity: 100
    refill_rate: 5.0     # 300 req/min
    enabled: true

  "/api/v1/admin/analytics":
    capacity: 50
    refill_rate: 2.0     # 120 req/min
    enabled: true

  # Webhooks - lenient (external services calling)
  "/api/v1/webhooks/payment":
    capacity: 100
    refill_rate: 10.0    # 600 req/min
    enabled: true

  # Health check - no rate limiting (monitoring services)
  "/health":
    capacity: 1000
    refill_rate: 1000.0  # Effectively unlimited
    enabled: false       # Or set very high limits

# Use API key from header for identification
# Falls back to IP if X-API-Key header is missing
key_extractor: "header:X-API-Key"

# Clean up buckets idle for more than 2 hours to manage memory
cleanup_age: "2h"
